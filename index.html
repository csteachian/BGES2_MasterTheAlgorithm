<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BGE Computing Science: Master the Algorithm</title>
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>
    <script src="/_sdk/element_sdk.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        font-family: "Space Grotesk", sans-serif;
      }
      .code-font {
        font-family: "JetBrains Mono", monospace;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }
      @keyframes pulse-glow {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }
        50% {
          box-shadow: 0 0 40px rgba(34, 197, 94, 0.6);
        }
      }
      @keyframes slide-in {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .float-animation {
        animation: float 3s ease-in-out infinite;
      }
      .pulse-glow {
        animation: pulse-glow 2s ease-in-out infinite;
      }
      .slide-in {
        animation: slide-in 0.5s ease-out forwards;
      }

      .grid-pattern {
        background-image:
          linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
        background-size: 40px 40px;
      }
      .cornerstone-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .cornerstone-card:hover {
        transform: translateY(-8px) scale(1.02);
      }

      /* Strikethrough + dim for ticked bug steps */
      .step-bugged {
        opacity: 0.45;
        text-decoration: line-through;
      }
    </style>
    <style>
      body {
        box-sizing: border-box;
      }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  </head>
  <body class="h-full">
    <div
      id="app-wrapper"
      class="w-full h-full overflow-auto grid-pattern"
      style="background-color: #0f172a"
    >
      <!-- Header -->
      <header
        class="relative overflow-hidden py-16 px-6"
        style="
          background: linear-gradient(
            135deg,
            #1e3a5f 0%,
            #0f172a 50%,
            #064e3b 100%
          );
        "
      >
        <div class="absolute inset-0 opacity-20">
          <div
            class="absolute top-10 left-10 text-6xl float-animation"
            style="animation-delay: 0s"
          >
            ğŸ’»
          </div>
          <div
            class="absolute top-20 right-20 text-5xl float-animation"
            style="animation-delay: 0.5s"
          >
            ğŸ§ 
          </div>
          <div
            class="absolute bottom-10 left-1/4 text-4xl float-animation"
            style="animation-delay: 1s"
          >
            âš¡
          </div>
          <div
            class="absolute bottom-20 right-1/3 text-5xl float-animation"
            style="animation-delay: 1.5s"
          >
            ğŸ”§
          </div>
        </div>
        <div class="max-w-4xl mx-auto text-center relative z-10">
          <div
            class="inline-block px-4 py-2 rounded-full text-sm font-medium mb-6"
            style="
              background-color: rgba(34, 197, 94, 0.2);
              color: #4ade80;
              border: 1px solid rgba(34, 197, 94, 0.3);
            "
          >
            BGE Computing Science
          </div>
          <h1
            id="main-title"
            class="text-4xl md:text-6xl font-bold mb-4"
            style="
              color: #ffffff;
              text-shadow: 0 0 40px rgba(59, 130, 246, 0.5);
            "
          >
            Master the Algorithm
          </h1>
          <p class="text-xl opacity-80" style="color: #94a3b8">
            Learn to think like a computer scientist
          </p>
        </div>
      </header>

      <!-- Introduction Section -->
      <section class="py-16 px-6">
        <div class="max-w-3xl mx-auto">
          <div
            class="rounded-2xl p-8 border"
            style="background-color: #1e293b; border-color: #334155"
          >
            <div class="flex items-center gap-3 mb-6">
              <span class="text-3xl">ğŸ¤”</span>
              <h2
                id="intro-heading"
                class="text-2xl font-bold"
                style="color: #ffffff"
              >
                The Complex Problem
              </h2>
            </div>
            <p class="text-lg leading-relaxed mb-6" style="color: #cbd5e1">
              A <strong style="color: #60a5fa">complex problem</strong> is one
              we don't know how to solve easily at first glance. It might seem
              overwhelming, confusing, or just plain tricky! But here's the
              secret: every complex problem can be solved if we approach it the
              right way.
            </p>
            <p class="text-lg leading-relaxed mb-8" style="color: #cbd5e1">
              Computer scientists use a special toolkit called
              <strong style="color: #4ade80">Computational Thinking</strong> to
              tackle these challenges. It's not about being a genius â€” it's
              about having the right strategy!
            </p>
            <button
              onclick="
                document
                  .getElementById('cornerstones')
                  .scrollIntoView({ behavior: 'smooth' })
              "
              class="group flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all pulse-glow"
              style="background-color: #22c55e; color: #052e16"
            >
              Let's break it down!
              <span class="group-hover:translate-x-1 transition-transform"
                >â†’</span
              >
            </button>
          </div>
        </div>
      </section>

      <!-- Four Cornerstones Section -->
      <section
        id="cornerstones"
        class="py-16 px-6"
        style="background-color: rgba(30, 58, 95, 0.3)"
      >
        <div class="max-w-5xl mx-auto">
          <div class="text-center mb-12">
            <span class="text-4xl mb-4 block">ğŸ›ï¸</span>
            <h2 class="text-3xl font-bold mb-2" style="color: #ffffff">
              The Four Cornerstones
            </h2>
            <p style="color: #94a3b8">of Computational Thinking</p>
          </div>
          <div class="grid md:grid-cols-2 gap-6">
            <!-- Decomposition -->
            <div
              class="cornerstone-card rounded-2xl p-6 border cursor-pointer"
              style="
                background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%);
                border-color: #3b82f6;
              "
              onclick="this.querySelector('.detail').classList.toggle('hidden')"
            >
              <div class="flex items-start gap-4">
                <div
                  class="w-14 h-14 rounded-xl flex items-center justify-center text-2xl flex-shrink-0"
                  style="background-color: rgba(59, 130, 246, 0.2)"
                >
                  ğŸ§©
                </div>
                <div>
                  <h3 class="text-xl font-bold mb-2" style="color: #60a5fa">
                    Decomposition
                  </h3>
                  <p style="color: #cbd5e1">
                    Breaking down a complex problem into small, manageable
                    parts.
                  </p>
                  <div
                    class="detail hidden mt-4 pt-4 border-t"
                    style="border-color: #334155"
                  >
                    <p class="text-sm" style="color: #94a3b8">
                      <strong>Example:</strong> Building a house â†’ Foundation,
                      walls, roof, plumbing, electrical... Each part is easier
                      to handle alone!
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <!-- Pattern Recognition -->
            <div
              class="cornerstone-card rounded-2xl p-6 border cursor-pointer"
              style="
                background: linear-gradient(135deg, #064e3b 0%, #1e293b 100%);
                border-color: #22c55e;
              "
              onclick="this.querySelector('.detail').classList.toggle('hidden')"
            >
              <div class="flex items-start gap-4">
                <div
                  class="w-14 h-14 rounded-xl flex items-center justify-center text-2xl flex-shrink-0"
                  style="background-color: rgba(34, 197, 94, 0.2)"
                >
                  ğŸ”
                </div>
                <div>
                  <h3 class="text-xl font-bold mb-2" style="color: #4ade80">
                    Pattern Recognition
                  </h3>
                  <p style="color: #cbd5e1">
                    Looking at how similar problems were solved previously.
                  </p>
                  <div
                    class="detail hidden mt-4 pt-4 border-t"
                    style="border-color: #334155"
                  >
                    <p class="text-sm" style="color: #94a3b8">
                      <strong>Example:</strong> "This math problem looks like
                      one I solved yesterday!" Spotting patterns saves time and
                      effort.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <!-- Abstraction -->
            <div
              class="cornerstone-card rounded-2xl p-6 border cursor-pointer"
              style="
                background: linear-gradient(135deg, #4c1d95 0%, #1e293b 100%);
                border-color: #a855f7;
              "
              onclick="this.querySelector('.detail').classList.toggle('hidden')"
            >
              <div class="flex items-start gap-4">
                <div
                  class="w-14 h-14 rounded-xl flex items-center justify-center text-2xl flex-shrink-0"
                  style="background-color: rgba(168, 85, 247, 0.2)"
                >
                  ğŸ¯
                </div>
                <div>
                  <h3 class="text-xl font-bold mb-2" style="color: #c084fc">
                    Abstraction
                  </h3>
                  <p style="color: #cbd5e1">
                    Focusing only on important details and ignoring irrelevant
                    info.
                  </p>
                  <div
                    class="detail hidden mt-4 pt-4 border-t"
                    style="border-color: #334155"
                  >
                    <p class="text-sm" style="color: #94a3b8">
                      <strong>Example:</strong> A map doesn't show every tree â€”
                      just the roads you need! Filter out the noise to see
                      clearly.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <!-- Algorithms -->
            <div
              class="cornerstone-card rounded-2xl p-6 border cursor-pointer"
              style="
                background: linear-gradient(135deg, #9a3412 0%, #1e293b 100%);
                border-color: #f97316;
              "
              onclick="this.querySelector('.detail').classList.toggle('hidden')"
            >
              <div class="flex items-start gap-4">
                <div
                  class="w-14 h-14 rounded-xl flex items-center justify-center text-2xl flex-shrink-0"
                  style="background-color: rgba(249, 115, 22, 0.2)"
                >
                  ğŸ“
                </div>
                <div>
                  <h3 class="text-xl font-bold mb-2" style="color: #fb923c">
                    Algorithms
                  </h3>
                  <p style="color: #cbd5e1">
                    Developing the step-by-step rules to solve the problem.
                  </p>
                  <div
                    class="detail hidden mt-4 pt-4 border-t"
                    style="border-color: #334155"
                  >
                    <p class="text-sm" style="color: #94a3b8">
                      <strong>Example:</strong> A recipe is an algorithm! Step
                      1, Step 2, Step 3... Follow the instructions precisely.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- The Challenge Section -->
      <section class="py-16 px-6">
        <div class="max-w-4xl mx-auto">
          <div class="text-center mb-12">
            <span class="text-4xl mb-4 block">ğŸ›</span>
            <h2
              id="challenge-heading"
              class="text-3xl font-bold mb-2"
              style="color: #ffffff"
            >
              The Challenge: Buggy Algorithm v2
            </h2>
            <p id="challenge-description" style="color: #94a3b8">
              Can you spot the bugs in this algorithm?
            </p>
          </div>
          <div class="grid lg:grid-cols-2 gap-8">
            <!-- Buggy Algorithm -->
            <div
              class="rounded-2xl border overflow-hidden"
              style="background-color: #1e293b; border-color: #334155"
            >
              <div
                class="px-6 py-4 border-b flex items-center gap-2"
                style="background-color: #0f172a; border-color: #334155"
              >
                <span
                  class="w-3 h-3 rounded-full"
                  style="background-color: #ef4444"
                ></span>
                <span
                  class="w-3 h-3 rounded-full"
                  style="background-color: #eab308"
                ></span>
                <span
                  class="w-3 h-3 rounded-full"
                  style="background-color: #22c55e"
                ></span>
                <span
                  class="ml-2 code-font text-sm"
                  id="algo-filename"
                  style="color: #94a3b8"
                  >algorithm_v2.algo</span
                >
              </div>
              <div class="p-6">
                <h3
                  id="algo-panel-title"
                  class="font-bold mb-4 flex items-center gap-2"
                  style="color: #ffffff"
                >
                  Algorithm steps (v2)
                </h3>
                <div
                  class="space-y-2 code-font text-sm"
                  id="algorithm-list"
                ></div>
                <div
                  class="mt-6 p-4 rounded-xl"
                  style="
                    background-color: rgba(59, 130, 246, 0.1);
                    border: 1px solid rgba(59, 130, 246, 0.3);
                  "
                >
                  <p class="text-sm" style="color: #93c5fd">
                    <strong>ğŸ› Can you spot the bugs?</strong><br />
                    <span style="color: #94a3b8"
                      >Tick any step you think is wrong.
                      <span style="color: #4ade80">Green = correct bug</span>,
                      <span style="color: #f87171">red = not a bug</span>. Bugs
                      are removed from the Fix It Zone.</span
                    >
                  </p>
                </div>
              </div>
            </div>

            <!-- Fix It Area -->
            <div
              class="rounded-2xl border"
              style="background-color: #1e293b; border-color: #334155"
            >
              <div
                class="px-6 py-4 border-b flex items-center gap-2"
                style="background-color: #064e3b; border-color: #334155"
              >
                <span class="text-xl">ğŸ”§</span>
                <span class="font-semibold" style="color: #4ade80"
                  >Fix It Zone: Reorder v3</span
                >
              </div>
              <div class="p-6">
                <p class="mb-4" style="color: #cbd5e1">
                  Drag the steps below to create the
                  <strong style="color: #4ade80">correct order</strong> for
                  brushing teeth properly! <br /><span
                    class="text-sm"
                    style="color: #64748b"
                    >(Ticked bugs are hidden here.)</span
                  >
                </p>
                <div
                  id="correct-steps-area"
                  class="space-y-2 mb-4 min-h-64 rounded-xl p-4 border-2 border-dashed"
                  style="
                    background-color: rgba(34, 197, 94, 0.05);
                    border-color: rgba(34, 197, 94, 0.3);
                  "
                >
                  <p
                    style="
                      color: #94a3b8;
                      text-align: center;
                      padding-top: 80px;
                    "
                  >
                    Drag steps here to reorganize...
                  </p>
                </div>
                <div class="flex gap-3 mt-4">
                  <button
                    onclick="checkOrder()"
                    class="flex-1 px-4 py-3 rounded-xl font-semibold transition-all hover:scale-105"
                    style="background-color: #22c55e; color: #052e16"
                  >
                    âœ“ Check Order
                  </button>
                  <button
                    onclick="resetOrder()"
                    class="px-4 py-3 rounded-xl font-semibold transition-all hover:scale-105"
                    style="background-color: #334155; color: #94a3b8"
                  >
                    â†º Reset
                  </button>
                </div>
                <div id="feedback" class="mt-4 hidden"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Tips Section -->
      <section
        class="py-12 px-6"
        style="background-color: rgba(30, 58, 95, 0.3)"
      >
        <div class="max-w-3xl mx-auto">
          <div
            class="rounded-2xl p-6 border"
            style="background-color: #1e293b; border-color: #334155"
          >
            <h3
              class="font-bold mb-4 flex items-center gap-2"
              style="color: #ffffff"
            >
              <span>ğŸ’¡</span> Tips for Writing Good Algorithms
            </h3>
            <ul class="space-y-3" style="color: #cbd5e1">
              <li class="flex items-start gap-3">
                <span
                  class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"
                  style="background-color: #3b82f6; color: white"
                  >1</span
                >
                <span
                  >Be <strong style="color: #60a5fa">specific</strong> â€” "Apply
                  pea-sized amount" is better than "Apply toothpaste"</span
                >
              </li>
              <li class="flex items-start gap-3">
                <span
                  class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"
                  style="background-color: #22c55e; color: white"
                  >2</span
                >
                <span
                  >Use
                  <strong style="color: #4ade80">exact numbers</strong> where
                  needed â€” "Brush for 2 minutes" not "Brush for a while"</span
                >
              </li>
              <li class="flex items-start gap-3">
                <span
                  class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"
                  style="background-color: #a855f7; color: white"
                  >3</span
                >
                <span
                  >Make sure steps are in the
                  <strong style="color: #c084fc">correct order</strong> â€” You
                  can't rinse before brushing!</span
                >
              </li>
              <li class="flex items-start gap-3">
                <span
                  class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"
                  style="background-color: #f97316; color: white"
                  >4</span
                >
                <span
                  >Don't
                  <strong style="color: #fb923c">skip important steps</strong> â€”
                  Every tooth matters!</span
                >
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer
        class="py-12 px-6 text-center"
        style="background-color: #0f172a; border-top: 1px solid #334155"
      >
        <div class="max-w-2xl mx-auto">
          <div class="text-4xl mb-4">ğŸš€</div>
          <p
            id="footer-text"
            class="text-lg font-medium mb-2"
            style="color: #ffffff"
          >
            Once these steps are perfect, we use them to program a computer!
          </p>
          <p style="color: #64748b">
            Computational thinking is the foundation of all programming. Master
            these skills, and you'll be ready to create amazing things!
          </p>
          <div class="mt-6 flex justify-center gap-4">
            <span
              class="px-3 py-1 rounded-full text-xs"
              style="background-color: #1e3a5f; color: #60a5fa"
              >BGE Computing</span
            >
            <span
              class="px-3 py-1 rounded-full text-xs"
              style="background-color: #064e3b; color: #4ade80"
              >Scotland</span
            >
            <span
              class="px-3 py-1 rounded-full text-xs"
              style="background-color: #4c1d95; color: #c084fc"
              >Level 3/4</span
            >
          </div>
        </div>
      </footer>
    </div>
    <!-- end app-wrapper -->

    <script>
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // State
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      let currentAlgorithm = null; // loaded from algorithms.json
      let algorithmSteps = []; // working copy â€” all steps minus ticked bugs
      let tickedBugs = new Set(); // IDs the student has correctly ticked as bugs
      let wrongTicks = new Set(); // IDs incorrectly ticked (not a bug)
      let draggedElement = null;

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Load JSON from file, then initialise
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      async function loadAlgorithms() {
        try {
          const response = await fetch("algorithms.json");
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          const data = await response.json();

          // Pick a random algorithm from the available keys
          const keys = Object.keys(data);
          const randomKey = keys[Math.floor(Math.random() * keys.length)];
          currentAlgorithm = data[randomKey];

          // Update page headings to match the chosen algorithm
          document.getElementById("challenge-heading").textContent =
            currentAlgorithm.title;
          document.getElementById("challenge-description").textContent =
            currentAlgorithm.description;
          document.getElementById("algo-filename").textContent =
            randomKey.replace(/_/g, "-") + "_v2.algo";
          document.getElementById("algo-panel-title").textContent =
            currentAlgorithm.title
              .replace("Buggy Algorithm", "Algorithm")
              .replace("Buggy Algorithm v2 â€”", "Algorithm:");

          // Start with ALL steps in original order â€” bugs vanish as they are ticked
          algorithmSteps = [...currentAlgorithm.steps];
          populateAlgorithm();
          createDraggableSteps();
        } catch (err) {
          console.error("Failed to load algorithms.json:", err);
          document.getElementById("algorithm-list").innerHTML =
            `<p style="color:#ef4444">âš ï¸ Could not load algorithm data. Make sure algorithms.json is in the same folder as this HTML file.</p>`;
        }
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Bug-spotting list (left panel)
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function populateAlgorithm() {
        const list = document.getElementById("algorithm-list");
        list.innerHTML = currentAlgorithm.steps
          .map((step, index) => {
            const isBugTicked = tickedBugs.has(step.id);
            const isWrongTicked = wrongTicks.has(step.id);
            const isTicked = isBugTicked || isWrongTicked;

            let rowStyle = "border:1px solid transparent;";
            let textClass = "";
            let labelIcon = "";

            if (isBugTicked) {
              rowStyle =
                "background-color:rgba(34,197,94,0.15);border:1px solid rgba(34,197,94,0.4);";
              textClass = "step-bugged";
              labelIcon =
                ' <span style="color:#4ade80;font-size:0.75rem;">âœ“ Bug!</span>';
            } else if (isWrongTicked) {
              rowStyle =
                "background-color:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.4);";
              labelIcon =
                ' <span style="color:#f87171;font-size:0.75rem;">âœ— Not a bug</span>';
            }

            return `
              <div class="flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all"
                   onclick="toggleBug('${step.id}')"
                   id="step-${step.id}"
                   style="${rowStyle}">
                <input type="checkbox"
                       class="w-5 h-5 rounded pointer-events-none"
                       style="accent-color:${isBugTicked ? "#22c55e" : isWrongTicked ? "#ef4444" : "#94a3b8"}"
                       ${isTicked ? "checked" : ""}>
                <span class="opacity-50 code-font">${index + 1}.</span>
                <span class="${textClass}" style="color:#cbd5e1;">
                  ${step.text}${labelIcon}
                </span>
              </div>`;
          })
          .join("");
      }

      // Toggle a step tick:
      //   - Real bugs:  green highlight, removed from Fix It Zone; untick restores at original position
      //   - Non-bugs:   red highlight only, Fix It Zone unaffected
      function toggleBug(stepId) {
        const step = currentAlgorithm.steps.find((s) => s.id === stepId);
        if (!step) return;

        if (step.hasBug) {
          if (tickedBugs.has(stepId)) {
            // Untick â€” restore step to Fix It Zone at its original relative position
            tickedBugs.delete(stepId);
            const originalIndex = currentAlgorithm.steps.findIndex(
              (s) => s.id === stepId,
            );
            let insertAt = algorithmSteps.length;
            for (let i = originalIndex - 1; i >= 0; i--) {
              const prevId = currentAlgorithm.steps[i].id;
              const pos = algorithmSteps.findIndex((s) => s.id === prevId);
              if (pos !== -1) {
                insertAt = pos + 1;
                break;
              }
            }
            algorithmSteps.splice(insertAt, 0, step);
          } else {
            // Tick â€” remove from Fix It Zone
            tickedBugs.add(stepId);
            algorithmSteps = algorithmSteps.filter((s) => s.id !== stepId);
          }
          createDraggableSteps();
        } else {
          // Not a bug â€” just toggle the red highlight, no Fix It Zone change
          if (wrongTicks.has(stepId)) {
            wrongTicks.delete(stepId);
          } else {
            wrongTicks.add(stepId);
          }
        }

        populateAlgorithm();
        document.getElementById("feedback").classList.add("hidden");
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Drag-and-drop reorder list (right panel)
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function createDraggableSteps() {
        const area = document.getElementById("correct-steps-area");
        area.innerHTML = "";
        area.style.cssText =
          "background-color:rgba(34,197,94,0.05);border-color:rgba(34,197,94,0.3);";

        if (algorithmSteps.length === 0) {
          area.innerHTML =
            '<p style="color:#94a3b8;text-align:center;padding-top:80px">No steps left â€” untick some bugs to add them back!</p>';
          return;
        }

        algorithmSteps.forEach((step, index) => {
          const el = document.createElement("div");
          el.className =
            "draggable-step p-3 rounded-lg cursor-move transition-all border code-font text-sm";
          el.style.cssText =
            "background-color:#334155;border-color:#475569;color:#cbd5e1;";
          el.draggable = true;
          el.dataset.stepId = step.id;
          el.innerHTML = `<span class="opacity-50">${index + 1}.</span> ${step.text}`;

          el.addEventListener("dragstart", dragStart);
          el.addEventListener("dragend", dragEnd);
          el.addEventListener("dragover", dragOver);
          el.addEventListener("drop", dragDrop);
          el.addEventListener("dragenter", dragEnter);
          el.addEventListener("dragleave", dragLeave);

          area.appendChild(el);
        });
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Drag handlers
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function dragStart(e) {
        draggedElement = this;
        this.style.opacity = "0.5";
        e.dataTransfer.effectAllowed = "move";
      }
      function dragEnd() {
        this.style.opacity = "1";
        document.querySelectorAll(".draggable-step").forEach((el) => {
          el.style.backgroundColor = "#334155";
          el.style.borderColor = "#475569";
        });
      }
      function dragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = "move";
        return false;
      }
      function dragEnter() {
        if (this !== draggedElement) {
          this.style.backgroundColor = "#4ade80";
          this.style.borderColor = "#22c55e";
          this.style.color = "#052e16";
        }
      }
      function dragLeave() {
        if (this !== draggedElement) {
          this.style.backgroundColor = "#334155";
          this.style.borderColor = "#475569";
          this.style.color = "#cbd5e1";
        }
      }
      function dragDrop(e) {
        e.preventDefault();
        e.stopPropagation();
        if (this !== draggedElement) {
          const fromId = draggedElement.dataset.stepId;
          const toId = this.dataset.stepId;
          const fromIdx = algorithmSteps.findIndex((s) => s.id === fromId);
          const toIdx = algorithmSteps.findIndex((s) => s.id === toId);
          // Swap
          [algorithmSteps[fromIdx], algorithmSteps[toIdx]] = [
            algorithmSteps[toIdx],
            algorithmSteps[fromIdx],
          ];
          createDraggableSteps();
        }
        return false;
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Check / reset
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function checkOrder() {
        const feedback = document.getElementById("feedback");

        const allBugsFound = currentAlgorithm.steps
          .filter((s) => s.hasBug)
          .every((s) => tickedBugs.has(s.id));

        const expectedOrder = currentAlgorithm.correctOrder;
        const currentOrder = algorithmSteps.map((s) => s.id);

        feedback.className = "mt-4 p-4 rounded-xl";

        if (!allBugsFound) {
          const remaining = currentAlgorithm.steps.filter(
            (s) => s.hasBug && !tickedBugs.has(s.id),
          ).length;
          feedback.style.backgroundColor = "rgba(234,179,8,0.1)";
          feedback.style.border = "1px solid rgba(234,179,8,0.3)";
          feedback.innerHTML = `
            <p style="color:#fcd34d"><strong>ğŸ› Not all bugs found yet!</strong></p>
            <p style="color:#94a3b8" class="text-sm mt-1">
              There are still <strong style="color:#fcd34d">${remaining}</strong> bug${remaining !== 1 ? "s" : ""} hiding in the left panel. Find and tick them first!
            </p>`;
        } else if (
          JSON.stringify(currentOrder) === JSON.stringify(expectedOrder)
        ) {
          feedback.style.backgroundColor = "rgba(34,197,94,0.1)";
          feedback.style.border = "1px solid rgba(34,197,94,0.3)";
          feedback.innerHTML = `
            <p style="color:#4ade80"><strong>ğŸ‰ Perfect â€” bugs found and correct order!</strong></p>
            <p style="color:#94a3b8" class="text-sm mt-1">
              You've identified all the bugs and put the remaining steps in the right order. That's a v3 algorithm!
            </p>`;
        } else {
          feedback.style.backgroundColor = "rgba(234,179,8,0.1)";
          feedback.style.border = "1px solid rgba(234,179,8,0.3)";
          feedback.innerHTML = `
            <p style="color:#fcd34d"><strong>ğŸ¤” Bugs found, but order needs work!</strong></p>
            <p style="color:#94a3b8" class="text-sm mt-1">
              All bugs are ticked â€” nice! Now drag the remaining steps into the correct logical order.
            </p>`;
        }
        feedback.classList.remove("hidden");
      }

      function resetOrder() {
        // Restore all steps to original order, clear all ticks
        tickedBugs = new Set();
        wrongTicks = new Set();
        algorithmSteps = [...currentAlgorithm.steps];
        populateAlgorithm();
        createDraggableSteps();
        document.getElementById("feedback").classList.add("hidden");
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // SDK config
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const defaultConfig = {
        main_title: "Master the Algorithm",
        intro_heading: "The Complex Problem",
        challenge_heading: "The Challenge: Buggy Algorithm v2",
        footer_text:
          "Once these steps are perfect, we use them to program a computer!",
        background_color: "#0f172a",
        surface_color: "#1e293b",
        text_color: "#ffffff",
        primary_action_color: "#22c55e",
        accent_color: "#3b82f6",
      };

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            document.getElementById("main-title").textContent =
              config.main_title || defaultConfig.main_title;
            document.getElementById("intro-heading").textContent =
              config.intro_heading || defaultConfig.intro_heading;
            document.getElementById("challenge-heading").textContent =
              config.challenge_heading || defaultConfig.challenge_heading;
            document.getElementById("footer-text").textContent =
              config.footer_text || defaultConfig.footer_text;
            document.getElementById("app-wrapper").style.backgroundColor =
              config.background_color || defaultConfig.background_color;
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () =>
                  config.background_color || defaultConfig.background_color,
                set: (v) =>
                  window.elementSdk.setConfig({ background_color: v }),
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (v) => window.elementSdk.setConfig({ surface_color: v }),
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (v) => window.elementSdk.setConfig({ text_color: v }),
              },
              {
                get: () =>
                  config.primary_action_color ||
                  defaultConfig.primary_action_color,
                set: (v) =>
                  window.elementSdk.setConfig({ primary_action_color: v }),
              },
              {
                get: () => config.accent_color || defaultConfig.accent_color,
                set: (v) => window.elementSdk.setConfig({ accent_color: v }),
              },
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined,
          }),
          mapToEditPanelValues: (config) =>
            new Map([
              ["main_title", config.main_title || defaultConfig.main_title],
              [
                "intro_heading",
                config.intro_heading || defaultConfig.intro_heading,
              ],
              [
                "challenge_heading",
                config.challenge_heading || defaultConfig.challenge_heading,
              ],
              ["footer_text", config.footer_text || defaultConfig.footer_text],
            ]),
        });
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Boot â€” load JSON then render
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      loadAlgorithms();
    </script>
  </body>
</html>
